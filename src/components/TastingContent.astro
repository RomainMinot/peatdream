---
interface Props {
  class?: string;
}

const { class: className } = Astro.props;
---

<div class={`prose prose-lg max-w-none ${className || ''}`}>
  <slot />
</div>

<style>
  .prose {
    color: rgb(var(--black));
    line-height: 1.75;
  }

  /* Titres avec espacement optimisé */
  .prose :global(h1) {
    @apply text-3xl sm:text-4xl md:text-5xl font-bold mb-6 mt-12 text-accent leading-tight;
    scroll-margin-top: 8rem;
  }

  .prose :global(h2) {
    @apply text-2xl sm:text-3xl font-semibold mb-4 mt-12 pt-4 text-accent border-b border-peat-400 pb-2 leading-tight;
    scroll-margin-top: 8rem;
  }

  .prose :global(h3) {
    @apply text-xl sm:text-2xl font-semibold mb-3 mt-10 text-accent-700 leading-snug;
    scroll-margin-top: 8rem;
  }

  .prose :global(h4) {
    @apply text-lg sm:text-xl font-semibold mb-2 mt-8 text-accent-800 leading-snug;
  }

  /* Paragraphes avec lecture optimale */
  .prose :global(p) {
    @apply text-base sm:text-lg leading-relaxed mb-5 text-gray-700;
    max-width: 70ch;
  }

  /* Liens stylisés */
  .prose :global(a) {
    @apply text-peat-600 hover:text-peat-700 underline decoration-peat-300 hover:decoration-peat-600 decoration-2 underline-offset-2 transition-all duration-200;
    word-break: break-word;
    overflow-wrap: break-word;
  }
  
  /* Liens contenant des images */
  .prose :global(a:has(img)) {
    @apply block my-8 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-2xl;
    text-decoration: none;
    position: relative;
  }
  
  .prose :global(a:has(img)::after) {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.3) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  
  .prose :global(a:has(img):hover::after) {
    opacity: 1;
  }
  
  .prose :global(a:has(img):hover img) {
    transform: scale(1.03);
  }

  /* Texte en gras */
  .prose :global(strong),
  .prose :global(b) {
    @apply font-bold text-accent-900;
  }

  /* Italique */
  .prose :global(em),
  .prose :global(i) {
    @apply italic text-gray-800;
  }

  /* Listes */
  .prose :global(ul),
  .prose :global(ol) {
    @apply my-8 space-y-3 pl-6;
  }

  .prose :global(li) {
    @apply text-base sm:text-lg md:text-xl leading-relaxed text-gray-700;
  }

  .prose :global(ul > li) {
    @apply pl-2 relative;
  }

  .prose :global(ul > li::marker) {
    @apply text-peat-600;
  }

  .prose :global(ol > li) {
    @apply pl-2;
  }

  .prose :global(ol > li::marker) {
    @apply text-peat-600 font-semibold;
  }

  /* Citations */
  .prose :global(blockquote) {
    @apply border-l-4 border-peat-500 pl-6 py-4 my-8 italic text-gray-700 bg-peat-50 rounded-r-lg;
  }

  .prose :global(blockquote p) {
    @apply mb-0;
  }

  /* Code inline */
  .prose :global(code) {
    @apply bg-accent-100 text-accent-900 px-2 py-1 rounded text-sm font-mono;
  }

  /* Blocs de code */
  .prose :global(pre) {
    @apply bg-accent-900 text-white p-4 sm:p-6 rounded-lg overflow-x-auto my-8 text-sm sm:text-base;
  }

  .prose :global(pre code) {
    @apply bg-transparent text-white p-0;
  }

  /* Images optimisées et responsive */
  .prose :global(img) {
    @apply rounded-lg shadow-md my-8 mx-auto max-w-full h-auto;
    max-height: 700px;
    object-fit: contain;
    display: block;
    transition: all 0.3s ease;
  }
  
  /* Images dans des liens */
  .prose :global(a img) {
    @apply shadow-none;
    margin: 0;
  }
  
  /* Images seules (pas dans des liens) */
  .prose :global(img:not(a img)) {
    @apply hover:shadow-xl;
    cursor: default;
  }
  
  /* Conteneurs d'images (liens ou paragraphes) */
  .prose :global(p:has(img)) {
    max-width: 100%;
    overflow: hidden;
  }

  .prose :global(figure) {
    @apply my-8;
  }

  .prose :global(figcaption) {
    @apply text-center text-sm text-gray-600 mt-3 italic;
  }

  /* Séparateurs élégants */
  .prose :global(hr) {
    @apply my-10 border-t border-accent-300;
  }

  /* Tableaux responsifs */
  .prose :global(table) {
    @apply w-full my-8 border-collapse text-sm sm:text-base;
    display: block;
    overflow-x: auto;
  }

  .prose :global(thead) {
    @apply bg-accent-100;
  }

  .prose :global(th) {
    @apply font-semibold p-3 sm:p-4 text-left border border-accent-300 text-accent-900;
  }

  .prose :global(td) {
    @apply p-3 sm:p-4 border border-accent-200 text-gray-700;
  }

  .prose :global(tr:nth-child(even)) {
    @apply bg-accent-50;
  }

  /* Responsive : ajustements mobiles */
  @media (max-width: 640px) {
    .prose {
      font-size: 16px;
    }

    .prose :global(img) {
      max-height: 400px;
    }
  }
</style>
